---
title: "TSA Final Project"
author: "Shubhangi Gupta, Aditi Jackson, David Robinson"
date: "2024-03-29"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Setup

```{r packages}
# loading packages
library(tidyverse)
library(dplyr)
library(lubridate)
library(readxl)
library(ggplot2)
library(forecast)
library(Kendall)
library(tseries)
library(outliers)
library(smooth)
library(readr)
library(zoo)
library(cowplot)

```

# Data Wrangling

```{r wrangle}
# importing data
transmission_RAW <- read_excel("Data/Raw/Transmission_Lines_1711480217358.xlsx",
                               col_names=TRUE)

#renaming columns, subsetting date and line length columns and dropping NAs
transmission_CLEAN <- transmission_RAW %>%
  select("Line Length (cKM)","Month Of Completion","Year Of Completion (FY)") %>%
  rename("LineLength"= "Line Length (cKM)",
         "Month"="Month Of Completion",
         "Year"="Year Of Completion (FY)")

# checking for N/As
any(is.na(transmission_CLEAN))

#splitting into month and 2-digit year
transmission_CLEAN <- transmission_CLEAN %>%
  separate(col = Month, into = c("Month", "YearSep"), sep = "-")

#transforming to 4-digit year
transmission_CLEAN$four_digit_year <- as.numeric(paste0("20", transmission_CLEAN$YearSep))

#concatenating into month and 4-digit year
transmission_CLEAN <- transmission_CLEAN %>%
  mutate(Date = paste0(Month, sep = "-", four_digit_year))

#converting date column into a date object
transmission_CLEAN$Date <- my(transmission_CLEAN$Date)

# grouping by date and summing up line length
transmission_CLEAN <- transmission_CLEAN %>%
  group_by(Date)%>%
  summarise(TotalLineLength = sum(LineLength)) %>%
  select("TotalLineLength","Date")

#Initial plot
ggplot(transmission_CLEAN,aes(x=Date,y=TotalLineLength))+
 geom_line() +
  geom_smooth(method = lm)

```
*Analysis*: Since theit showcases a declining trend, we explored if the data represented transmission or distribution. The datasource clearly states that it is transmission data only. We further explored the voltage levels of  this data to see if the decline could be attributed to the addition of higher efficiency voltage lines but found from xxx datasource that that is not the case. Thus we proceed with the findnig that transmission capacity additions have declined in India between 2015 and 2023.

# [ADD]

```{r time series}

#creating time series object
transmission_ts <- ts(transmission_CLEAN,start=c(2016,1),end = c(2023,12),frequency = 12)

#Plotting the time series, ACF and PACF
ts_plot <- autoplot(transmission_ts[,1])
ACF <- Acf(transmission_ts[,1], lag.max = 40, plot=FALSE)
PACF <- Pacf(transmission_ts[,1], lag.max = 40, plot=FALSE)

plot_grid(ts_plot, autoplot(ACF), autoplot(PACF), nrow = 1)

#Observations: trend is declining, ACF - significant -> MA required

```

## [ADD]

```{r}

#Decompose
transmission_ts_decomp <- decompose(transmission_ts[,1], "multiplicative")
print(plot(transmission_ts_decomp))

#Observation: residual still has seasonality -> differencing required? declining trend confirmed. seasonality exists.
#Seasonality explained: declines in the middle of the year during monsoon.

#Mann-Kendall and ADF to determine d term of ARIMA
SMKtest <- SeasonalMannKendall(transmission_ts[,1])
print(summary(SMKtest))

ADFTest <- adf.test(transmission_ts[,1], alternative = "stationary")
print(ADFTest)

#Observation: both are rejected. SMK rejection -> deterministic. ADF rejection -> stationary.
#Talk to Luana about this!!

#Deseason??

#Defining the training and testing datasets and converting to time series
transmission_training <- transmission_CLEAN[1:96,]
transmission_testing <- transmission_CLEAN[97:107,]

transmission_ts_training <- ts(transmission_training, start=c(2016,1),end = c(2023,12),frequency = 12)
transmission_ts_testing <- ts(transmission_testing, start=c(2016,1),end = c(2023,12),frequency = 12)

#Fitting the model
auto.arima(transmission_ts_training[,1])
transmission_training_ARIMA311101 <- Arima(transmission_ts_training[,1], 
                                           order=c(3,1,1), seasonal=c(1,0,1), 
                                           include.constant = TRUE)
summary(transmission_training_ARIMA311101)
checkresiduals(transmission_training_ARIMA311101)

#Forecasting it on the testing data
Forecast1 <- forecast(transmission_training_ARIMA311101, h=12)

autoplot(transmission_ts[,1], series = "original")+
  autolayer(transmission_training_ARIMA311101$fitted, series = "SARIMA")+
  autolayer(Forecast1$mean, series = "SARIMA_forecast")
```

## [ADD]

```{r}

```

## [ADD]

```{r}

```

## [ADD]

```{r}

```

## [ADD]

```{r}

```

## [ADD]

```{r}

```

